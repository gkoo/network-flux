var GKUtils={ANIM_DURATION:1E3,getData:function(c){return c&&c.values&&c.values.length?c.values:null},extend:function(c,g){for(var f in g)g.hasOwnProperty(f)&&(c[f]=g[f]);return c},fadeIn:function(c){c.css("display","block");setTimeout(function(){c.css("opacity","1")},50)},fadeOut:function(c,g){g=g||500;c.css("opacity","0");setTimeout(function(){c.hide()},g)},animate:function(c,g,f){c.css(g);f&&setTimeout(f,this.ANIM_DURATION)}};
if(Array&&Array.prototype&&"undefined"===typeof Array.prototype.forEach)Array.prototype.forEach=function(c){var g;for(g=0;void 0>g;++g)c(this[g])};if(Object&&"undefined"===typeof Object.keys)Object.keys=function(c){var g=0,f;for(f in c)c.hasOwnProperty(f)&&++g};
if(Function&&Function.prototype&&!Function.prototype.bind)Function.prototype.bind=function(c){if("function"!==typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var g=Array.prototype.slice.call(arguments,1),f=this,n=function(){},o=function(){return f.apply(this instanceof n?this:c||window,g.concat(Array.prototype.slice.call(arguments)))};n.prototype=this.prototype;o.prototype=new n;return o};var NetworkGraph;
(function(){var c=$(window);$("#viewport");var g=$("#companyTitle"),f=GKUtils.ANIM_DURATION||1E3,n={},o=[],k=!1,l=!1,m,s,t,u,p,r,q,i,v;i={isInBounds:function(a,b,d){return this.xInBounds(a,d)&&this.yInBounds(b,d)},xInBounds:function(a,b){return 0<a-b&&890>a+b},yInBounds:function(a,b){return 0<a-b&&a+b<(k?200:660)},getRandomCenter:function(a){var b=Math.floor(890*Math.random()),d=Math.floor(Math.random()*(k?200:660));return i.moveAwayFromEdge(b,d,a)},isIntersecting:function(a,b){var d=a.r,e=b.r,j=
2*d,c=2*e,h=a.cx-d,g=b.cx-e,d=a.cy-d,e=b.cy-e;return h+j>=g&&h<=g+c&&d+j>=e&&d<=e+c},moveAwayFromEdge:function(a,b,d){var e=k?200:660;0>=a-d?a=d:890<a+d&&(a=890-d);0>=b-d?b=d:b+d>e&&(b=e-d);return{x:a,y:b}}};p=function(){};p.prototype={createEl:function(a,b,d,e){this.r=b;this.$circle=$("<div>").addClass("circle "+e+"-circ").css({width:2*b,height:2*b});this.setBorderRadius(b);this.$label=$("<span>").addClass(e+"-label").css({top:b-8+"px",left:b-100+"px"}).text(d);this.$circle.append(this.$label);this.$container=
$("<div>").addClass("circle-container "+e+"-circ-container").attr("id","circle-"+a).append(this.$circle);return this},setBorderRadius:function(a){a*=2;this.$circle.css({"-moz-border-radius":a+"px","-ms-border-radius":a+"px","-o-border-radius":a+"px","-webkit-border-radius":a+"px","border-radius":a+"px"})},show:function(){this.$container.show();return this},hide:function(){this.$container.hide();return this},move:function(a,b,d){var e={left:a-this.r,top:b-this.r};this.cx=a;this.cy=b;GKUtils.animate(this.$container,
e,d);return this},setRadius:function(a,b,d){var e=2*a;"undefined"===typeof b&&(b=!0);"undefined"===typeof d&&(d=!0);b&&this.$container.css({left:this.cx-a,top:this.cy-a});this.$circle.css({width:e+"px",height:e+"px"});d&&40<=a?this.$label.show():this.$label.hide();this.r=a;this.setBorderRadius(a);return this},setElPosition:function(a,b,d){this.cx=a;this.cy=b;this.$container.css({left:this.cx-d,top:this.cy-d});return this},findOpenSpace:function(a,b,d){var e=Math.PI,j=this.cx-a,c=b-this.cy,h=Math.sqrt(j*
j+c*c),h=Math.asin(c/h),d=Math.max(3*d/2,30)+this.r,g=[e/6,e/4,e/3,e/2,2*e/3,3*e/4,5*e/6,e],f;0>j&&0<c?h=e-h:0>h&&0>j&&0>c?h=e-h:this.cy===b&&0>j&&(h=e);e=a+Math.cos(h)*d;f=b+-1*Math.sin(h)*d;for(j=0,c=g.length;j<c&&!i.isInBounds(e,f,this.r);++j){f=h+g[j++];e=a+Math.cos(f)*d;f=b+-1*Math.sin(f)*d;if(i.isInBounds(e,f,this.r))break;f=h-g[j++];e=a+Math.cos(f)*d;f=b+-1*Math.sin(f)*d}if(!i.isInBounds(e,f,this.r))console.log("Couldn't find a in-bounds position to jump to!"),a=i.getRandomCenter(this.r),e=
a.x,f=a.y;this.move(e,f)},moveOverlapCirclesProto:function(a){var b=this,d=[];a.forEach(function(a){a!==b&&i.isIntersecting(b,a)&&d.push(a)});d.forEach(function(a){a.findOpenSpace(b.cx,b.cy,b.r)})},getContainer:function(){return this.$container}};u=function(){var a,b,d,e=function(){percent=d/910;c.trigger("sliderStop",percent);b&&(window.clearTimeout(b),b=null)},j=function(){b&&window.clearTimeout(b);b=setTimeout(e,100)},f=function(a,b){c.trigger("sliderStart");k&&m&&(k=!1,m.unhighlight(),l=!0,c.trigger("unhighlight"));
d=b.position.left;j()},g=function(a,b){percent=d/910;c.trigger("sliderDrag",percent);d=b.position.left;j()},i=function(){b&&(window.clearTimeout(b),b=null,e())};(function(){this.$el=$("#slider");a=this.$el.find("#sliderHandle");a.draggable({axis:"x",containment:"parent",start:f,drag:g,stop:i})})()};r=function(a){this.init(a)};r.prototype=new p;GKUtils.extend(r.prototype,{show:function(){var a=this;this.$container.show();setTimeout(function(){a.$container.css("top",a.top)},50)},hide:function(){var a=
this;GKUtils.animate(this.$container,{top:460},function(){a.$container.hide()})},setCenter:function(a,b){var d=this.IMG_DIM;this.el.attr({x:a-d/2,y:b-d/2})},setImageWidth:function(a){this.$container.find("img").css({width:a,height:a});return this},prepareElPosition:function(){var a=2*this.r;this.top=this.rowNum*a;this.left=this.colNum*a;this.setElPosition(this.left+this.r,460+this.r,this.r)},init:function(a){i.getRandomCenter(40);var b=$("<a>"),d=a.pictureUrl||"img/icon_no_photo_80x80.png",e=a.siteStandardProfileRequest?
a.siteStandardProfileRequest.url:"#",c=Math.random()/2+0.5+"s";this.id=a.id;this.profile=a;this.createEl(a.id,40,a.firstName+" "+a.lastName,"cxn");this.$container.css({"-moz-transition-duration":c,"-ms-transition-duration":c,"-o-transition-duration":c,"-webkit-transition-duration":c,"transition-duration":c});b.attr({href:e||"#",title:a.firstName+" "+a.lastName,target:"_new"});b.append($("<img>").addClass("cxn-picture").attr("src",d));this.$circle.append(b)}});q=function(a,b,d,e){this.init(a,b,d,e)};
q.prototype=new p;GKUtils.extend(q.prototype,{calculateCmpyRadius:function(a){return Math.max(100-1E3/(a+10),10)},moveOverlapCircles:function(){return this.moveOverlapCirclesProto.call(this,o)},setEmployees:function(a){var b=this.calculateCmpyRadius(a.length),d=this.cx,e=this.cy;this.employees=a;if(!i.isInBounds(d,e,b))a=i.moveAwayFromEdge(d,e,b),d=a.x,e=a.y,this.move(d,e);this.r!==b&&(this.setRadius(b),this.$label.css({top:b-8+"px",left:b-100+"px"}));return this},resetLabelPosition:function(){var a=
this.el;this.label.attr({x:a.attr("cx"),y:a.attr("cy")-a.attr("r")-5})},doHoverIn:function(){l||(this.$container.addClass("hover"),this.$label.show(),this.moveOverlapCircles())},doHoverOut:function(){this.$container.removeClass("hover");40>this.r&&this.$label.hide()},doClick:function(){!this.wasDragging&&!l&&((k=!k)?(this.highlight(),m=this,l=!0,c.trigger("highlight",{employees:this.employees})):(l=!0,m.unhighlight(),this==m?c.trigger("unhighlight"):(k=!0,this.highlight(),m=this,c.trigger("replaceEmployees",
{employees:this.employees}))));this.wasDragging=!1},doDragStop:function(a,b){this.wasDragging=!0;this.cx=b.position.left+this.r;this.cy=b.position.top+this.r;this.moveOverlapCircles()},highlight:function(){var a=this;this.$label.show();window.setTimeout(function(){a.$container.addClass("highlighted")},f)},unhighlight:function(){this.$container.removeClass("highlighted");GKUtils.fadeOut(g,f)},init:function(a,b,d,e){var c=this.calculateCmpyRadius(b.length),f=i.getRandomCenter(c),g=f.x,f=f.y;this.id=
a;this.origR=c;this.name=d;this.createEl(this.id,c,d,"cmpy").setElPosition(g,f,c);this.$circle.click(this.doClick.bind(this)).hover(this.doHoverIn.bind(this),this.doHoverOut.bind(this));this.$container.addClass(e?"school":"").css("position","absolute").draggable({containment:"parent",stop:this.doDragStop.bind(this)});40<=c&&this.$label.show();this.employees=b;this.pictures=[]}});v=function(){this.init()};v.prototype={$viewport:$("#companies"),add:function(a,b,d,e){a=new q(a,b,d,e);this.renderCompany(a);
return a},renderCompany:function(a){this.$viewport.append(a.getContainer())},showRemainingCompanies:function(a,b,d){var e,c;for(c in a)if(e=a[c])(cmpyCircle=n[c])?cmpyCircle.setEmployees(e).show():(cmpyCircle=this.add(c,a[c],t[c],b),n[c]=cmpyCircle),d.push(cmpyCircle)},renderCompanies:function(a,b){var d;l?this.cmpysToRender={companies:a,schools:b}:(d=[],o.forEach(function(e){var c=a[e.id],f=b[e.id];c?(e.setEmployees(c),d.push(e),a[e.id]=null):f?(e.setEmployees(f),d.push(e),b[e.id]=null):e.hide()}),
this.showRemainingCompanies(a,!1,d),this.showRemainingCompanies(b,!0,d),o=d)},resizeArea:function(){var a=k?200:660,b;k&&(b=function(){c.trigger("showEmployees")});GKUtils.animate(this.$viewport,{height:a+"px"},b);o.forEach(function(a){var b,c;k?(a.origCx=a.cx,a.origCy=a.cy,b=a.cy-a.r,c=a.cx,b=200*(b/660)+a.r,200<=b+a.r&&(b=200-a.r)):(c=a.origCx,b=a.origCy);a.setElPosition(c,b,a.r)})},resizeAreaDelayed:function(){setTimeout(this.resizeArea.bind(this),f);setTimeout(function(){l=!1;c.trigger("animComplete")},
f)},init:function(){var a=this;this.$el=$("#companies");c.on("highlight",this.resizeArea.bind(this));c.on("unhighlight",this.resizeAreaDelayed.bind(this));c.on("animComplete",function(){if(a.cmpysToRender)a.renderCompanies(a.cmpysToRender.companies,a.cmpysToRender.schools),a.cmpysToRender=null})}};ConnectionView=function(){this.init()};ConnectionView.prototype={pictureWidth:80,circles:{},currCxns:[],loadEmployees:function(a,b){var d=b.employees,c=d.length,f,g,h,i,k,w,x;63.96875<c?(this.pictureWidth=
Math.floor(9*Math.sqrt(409400/c)/10),this.pictureWidth=Math.max(30,this.pictureWidth)):this.pictureWidth=80;w=Math.floor(890/this.pictureWidth);x=(d.length-1)/w+1;for(c=0,f=d.length;c<f;++c)g=d[c],g=s[g],h=this.circles[g.id],i=Math.floor(c/w),k=c%w,h||(h=new r(g),this.circles[g.id]=h,this.$el.append(h.getContainer())),h.rowNum=i,h.colNum=k,h.setRadius(this.pictureWidth/2,!1,!1).setImageWidth(this.pictureWidth).prepareElPosition(w,x),this.currCxns.push(h);return this},showEmployees:function(){var a=
this;this.$el.addClass("show");setTimeout(function(){a.currCxns.forEach(function(a){a.show()})},50);setTimeout(function(){l=!1;c.trigger("animComplete")},f)},replaceEmployees:function(a,b){var c=this;this.hideEmployees(null,function(){c.loadEmployees(null,b).showEmployees()})},hideEmployees:function(a,b){var c=this;this.currCxns.forEach(function(a){a.hide()});this.currCxns=[];setTimeout(function(){c.$el.removeClass("show");b&&b()},f)},init:function(){this.$el=$("#connections");c.on("highlight",this.loadEmployees.bind(this));
c.on("showEmployees",this.showEmployees.bind(this));c.on("replaceEmployees",this.replaceEmployees.bind(this));c.on("unhighlight",this.hideEmployees.bind(this))}};NetworkGraph=function(){this.init()};NetworkGraph.prototype={setCompanies:function(a,b){this.cmpyCollection.renderCompanies(a,b)},setData:function(a){s=a.profiles||null;t=a.cmpyNames||null},init:function(){this.sliderBar=new u;this.cmpyCollection=new v;this.cxnView=new ConnectionView}}})();var onLinkedInLoad;
$(function(){var c,g,f,n=new NetworkGraph,o=(new Date).getTime(),k=$("#date"),l=$("#signin"),m,s,t,u,p,r,q,i,v="Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec".split(","),a=function(a){a=new Date(a);a.setDate(15);a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a},b=function(b,c){var d;m&&s&&(d=a(p+q*c),r=new Date,i.postMessage({allCmpyEmployees:m,allSchoolmates:s,targetDate:d.getTime()}))},d=function(b,c){var d,e;d=a(p+q*c);e=v[d.getMonth()];d=d.getFullYear();k.text(e+" "+
d)},e=function(){var a=GKUtils.getData(c),b=GKUtils.getData(g),d;if(!b||!a)throw"No profile data";b.push(a);f=b;d=new Date;a=new Worker("js/cxnWorker.js");a.addEventListener("message",function(a){if(a.data)m=a.data.companies,s=a.data.schools,t=a.data.cmpyNames,u=a.data.profileObjs,p=a.data.earliestDate,q=o-p,n.setData({profiles:u,cmpyNames:t}),console.log("Processing took "+((new Date).getTime()-d.getTime())+" milliseconds"),GKUtils.fadeIn($("#intro2, #slider, #share"))},!1);a.postMessage({profiles:f})},
j=function(a){$("#yourname").text(a.firstName);setTimeout(function(){GKUtils.fadeIn($("#intro1"))},500)},y=function(a){var b=GKUtils.getData(a);if(b&&b.length)j(b[0]);else throw"Couldn't find your profile!";c=a;g&&e()},h=function(a){g=a;c&&e()},z=function(a){var b=new Date,c;a.data&&(c=a.data.currCompanies||null,currSchools=a.data.currSchools||null);c&&(n.setCompanies(c,currSchools,t),console.log("Processing took "+(b.getTime()-r.getTime())+" milliseconds"))},A=function(){var a="id first-name last-name positions:(start-date,end-date,company:(id,name)) picture-url educations:(school-name,start-date,end-date) site-standard-profile-request:(url)".split(" ");
GKUtils.fadeOut(l,500);setTimeout(function(){GKUtils.fadeIn($("#companies"))},500);$("#viewport").show();IN.API.Profile("me").fields(a).result(y);IN.API.Connections("me").fields(a).result(h)};onLinkedInLoad=function(){GKUtils.fadeIn($("#signin, #title"));IN.Event.on(IN,"auth",A)};(function(){$(window).bind("sliderStop",b);$(window).bind("sliderDrag",d);$(window).bind("sliderStart",function(){GKUtils.fadeOut($(".intro"),500)});i=new Worker("js/snapshotWorker.js");i.addEventListener("message",z,!1)})()});
